<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="shortcut icon" href="#"/>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script type="text/javascript">
let empList = [];   // 전역에 담아둘 배열

function clearForm(){
	let o_e_id=document.getElementById('e_id');
    let o_e_name=document.getElementById('e_name');
    let o_gen=document.getElementById('gen');
    let o_addr=document.getElementById('addr');
    
    o_e_id.value	= "";
    o_e_name.value 	= "";
    o_gen.value 	= "";
    o_addr.value 	= "";
}

function fn_del(){
	
	const vo = {
		    e_id:   document.getElementById('e_id').value,
		    e_name: document.getElementById('e_name').value,
		    gen:    document.getElementById('gen').value,
		    addr:   document.getElementById('addr').value
		  };
	if(confirm("한번 지워진 데이터는 복구 불가능합니다.\n정말 삭제하겠습니까?")){
		axios.post('/emp_del.ajax', vo)
		.then(function (resp) {
		    // 성공했을 때
		    console.log('삭제 완료', resp.data.cnt)
		   	if(resp.data.cnt>=0){
		   		alert("삭제가 완료되었습니다");
		   	}else{
		   		alert("삭제 중 오류가 생겼습니다");
		   		}
		    clearForm();
		    fn_list();
	     
		  })
		  .catch(err => {
		      console.error('삭제 중 오류:', err);
		      if(err){
			   		alert("삭제 중 오류가 생겼습니다");
			   	}
		    });
	}
	
}

function fn_add(){
	console.log('fn_add 호출, empList =', empList);
	const vo = {
		    e_id:   document.getElementById('e_id').value.trim(),
		    e_name: document.getElementById('e_name').value,
		    gen:    document.getElementById('gen').value,
		    addr:   document.getElementById('addr').value
		  };
	
	// 2) e_id가 빈 문자열이면 경고 후 중단
	  if (!vo.e_id) {
	    alert("사번을 입력해주세요.");
	    document.getElementById('e_id').focus();
	    return;
	  }

	  // 3) 이미 존재하는 e_id인지 확인
	  if (empList.some(emp => emp.e_id === vo.e_id)) {
	    alert("이미 있는 사번입니다.");
	    document.getElementById('e_id').focus();
	    return;
	  }
	
	axios.post('/emp_add.ajax', vo)
	.then(function (resp) {
	    // 성공했을 때
	    console.log('입력 완료', resp.data.cnt)
	   	if(resp.data.cnt==1){
	   		alert("입력이 완료되었습니다");
	   	}else{
	   		alert("입력 중 오류가 생겼습니다");
	   	}
	    clearForm();
	    fn_list();
     
	  })
	  .catch(err => {
	      console.error('입력 중 오류:', err);
	      if(err){
		   		alert("입력 중 오류가 생겼습니다");
		   	}
	    });
}

function fn_mod(){
	 const vo = {
			    e_id:   document.getElementById('e_id').value,
			    e_name: document.getElementById('e_name').value,
			    gen:    document.getElementById('gen').value,
			    addr:   document.getElementById('addr').value
			  };
	
	
	
	axios.post('/emp_mod.ajax', vo)
	.then(function (resp) {
	    // 성공했을 때
	    console.log('수정 완료', resp.data.cnt)
	   	if(resp.data.cnt>=0){
	   		alert("수정이 완료되었습니다");
	   	}else{
	   		alert("수정 중 오류가 생겼습니다");
	   	}
	    clearForm();
	    fn_list();
     
	  })
	  .catch(err => {
	      console.error('수정 중 오류:', err);
	      if(err){
		   		alert("수정 중 오류가 생겼습니다");
		   	}
	    });
}

function fn_one(e_id){
	console.log("e_id : ",e_id)
	
	
	axios.get('/emp_detail.ajax', {
		  params: { e_id : e_id }})
	.then(function (resp) {
	    // 성공했을 때
	    console.log("vo : ", resp.data.vo);
	    

	    const vo = resp.data.vo; 
	    let o_e_id=document.getElementById('e_id');
	    let o_e_name=document.getElementById('e_name');
	    let o_gen=document.getElementById('gen');
	    let o_addr=document.getElementById('addr');
        
	    o_e_id.value	= vo.e_id;
	    o_e_name.value 	= vo.e_name;
	    o_gen.value 	= vo.gen;
	    o_addr.value 	= vo.addr;
     
	  })
}
function fn_list(){
	axios.get('/emp_list.ajax')
	.then(function (resp) {
	    // 성공했을 때
	    console.log(resp);
	    const list = resp.data.mylist;    // 서버에서 보낸 배열
	    empList = list;
		
	    const tbody = document.getElementById('my_tbody'); //배열을 넣을 테이블
        tbody.innerHTML = '';  
        
        list.forEach(emp => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td><a href="javascript:fn_one('${emp.e_id}')">${emp.e_id}</a></td>
              <td>${emp.e_name}</td>
              <td>${emp.gen}</td>
              <td>${emp.addr}</td>
            `;
            tbody.appendChild(tr);
        })    
	  })
}
</script>
</head>
<body onload="fn_list()">
EMP 화면


<table border="1">
	<thead>
		<tr>
			<td>사번</td>
			<td>이름</td>
			<td>성별</td>
			<td>주소</td>
		</tr>
	</thead>
	<tbody id="my_tbody">
		<tr>
			<td colspan="4">
				데이터가 없어유
			</td>
		</tr>
	</tbody>
</table>
<br/>
<table border="1">
	<tbody id="my_tbody1">
		<tr>
			<td>사번</td>
			<td>
				<input type="text" id="e_id"/>
			</td>
		</tr>
		<tr>
			<td>이름</td>
			<td>
				<input type="text" id="e_name"/>
			</td>
		</tr>
		<tr>
			<td>성별</td>
			<td>
				<input type="text" id="gen"/>
			</td>
		</tr>
		<tr>
			<td>주소</td>
			<td>
				<input type="text" id="addr"/>
			</td>
		</tr>
		<tr>
			<td colspan="2">
				<input type="button" value="추가" onclick="fn_add()"/>
				<input type="button" value="수정" onclick="fn_mod()"/>
				<input type="button" value="삭제" onclick="fn_del()"/>
			</td>
		</tr>
	</tbody>
</table>
</body>
</html>